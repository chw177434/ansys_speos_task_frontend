# æ–­ç‚¹ç»­ä¼ æ¥å£è§„èŒƒ

**åç«¯çŠ¶æ€**: âœ… å·²å®ç°  
**å‰ç«¯ä»»åŠ¡**: è°ƒç”¨ 6 ä¸ªæ¥å£å®ç°æ–­ç‚¹ç»­ä¼ 

---

## ğŸ“¡ æ¥å£æ¸…å•

| åºå· | æ¥å£ | æ–¹æ³• | å¿…é¡»/å¯é€‰ |
|------|------|------|----------|
| 1 | `/tasks/upload/multipart/init` | POST | â­ å¿…é¡» |
| 2 | `{part.upload_url}` | PUT | â­ å¿…é¡» |
| 3 | `/tasks/upload/multipart/complete` | POST | â­ å¿…é¡» |
| 4 | `/tasks/upload/confirm` | POST | â­ å¿…é¡» |
| 5 | `/tasks/upload/multipart/list` | POST | â­ æ–­ç‚¹ç»­ä¼ å¿…é¡» |
| 6 | `/tasks/upload/multipart/abort` | POST | âšª å¯é€‰ |

---

## 1ï¸âƒ£ åˆå§‹åŒ–åˆ†ç‰‡ä¸Šä¼ 

```
POST /tasks/upload/multipart/init
```

**è¯·æ±‚**:
```json
{
  "filename": "model.zip",
  "file_size": 524288000,
  "file_type": "master",
  "content_type": "application/zip",
  "chunk_size": 5242880
}
```

**å“åº”**:
```json
{
  "task_id": "abc-123",
  "upload_id": "upload-xyz",
  "object_key": "speos_tasks/...",
  "total_chunks": 100,
  "parts": [
    {
      "part_number": 1,
      "upload_url": "https://...",
      "start_byte": 0,
      "end_byte": 5242880,
      "size": 5242880
    }
  ]
}
```

---

## 2ï¸âƒ£ ä¸Šä¼ åˆ†ç‰‡

```
PUT {part.upload_url}
Body: Blob (æ–‡ä»¶åˆ†ç‰‡æ•°æ®)
Header: Content-Type: application/octet-stream
```

**å“åº”å¤´**:
```
ETag: "abc123"
```

**âš¡ å¿…é¡»è·å– ETag å¹¶ç§»é™¤å¼•å·ï¼**

---

## 3ï¸âƒ£ å®Œæˆä¸Šä¼ 

```
POST /tasks/upload/multipart/complete
```

**è¯·æ±‚**:
```json
{
  "task_id": "abc-123",
  "upload_id": "upload-xyz",
  "object_key": "speos_tasks/...",
  "file_type": "master",
  "parts": [
    {"part_number": 1, "etag": "abc123"},
    {"part_number": 2, "etag": "def456"}
  ]
}
```

**âš¡ parts å¿…é¡»æŒ‰ part_number æ’åºï¼**

---

## 4ï¸âƒ£ æäº¤ä»»åŠ¡

```
POST /tasks/upload/confirm
```

**è¯·æ±‚**:
```json
{
  "task_id": "abc-123",
  "master_object_key": "speos_tasks/...",
  "profile_name": "Standard",
  "version": "v252",
  "job_name": "ä»»åŠ¡å",
  "submitter": "æäº¤è€…",
  "thread_count": "8",
  "priority": "2"
}
```

---

## 5ï¸âƒ£ æŸ¥è¯¢å·²ä¸Šä¼ åˆ†ç‰‡ï¼ˆæ–­ç‚¹ç»­ä¼ ï¼‰

```
POST /tasks/upload/multipart/list
```

**è¯·æ±‚**:
```json
{
  "task_id": "abc-123",
  "upload_id": "upload-xyz",
  "object_key": "speos_tasks/..."
}
```

**å“åº”**:
```json
{
  "parts": [
    {"part_number": 1, "etag": "abc123"},
    {"part_number": 2, "etag": "def456"}
  ]
}
```

**ç”¨é€”**: æŸ¥è¯¢å“ªäº›åˆ†ç‰‡å·²ä¸Šä¼ ï¼Œè·³è¿‡å®ƒä»¬

---

## 6ï¸âƒ£ å–æ¶ˆä¸Šä¼ ï¼ˆå¯é€‰ï¼‰

```
POST /tasks/upload/multipart/abort
```

**è¯·æ±‚**:
```json
{
  "task_id": "abc-123",
  "upload_id": "upload-xyz",
  "object_key": "speos_tasks/..."
}
```

---

## ğŸ”„ è°ƒç”¨æµç¨‹

```
init â†’ è·å–parts[] 
  â†“
for each part:
  file.slice(start, end) â†’ PUT upload_url â†’ è·å–ETag
  â†“
complete â†’ ä¼ é€’æ‰€æœ‰[part_number, etag]
  â†“
confirm â†’ æäº¤ä»»åŠ¡
  â†“
å®Œæˆ
```

---

## ğŸ’¾ æ–­ç‚¹ç»­ä¼ å®ç°

### ä¿å­˜è¿›åº¦

```javascript
localStorage.setItem(`upload_${task_id}`, JSON.stringify({
  task_id, upload_id, object_key,
  uploaded_parts: [[1, "etag1"], [2, "etag2"]]
}));
```

### æ¢å¤è¿›åº¦

```javascript
const saved = localStorage.getItem(`upload_${task_id}`);
if (saved) {
  // è°ƒç”¨ list æ¥å£æŸ¥è¯¢æœåŠ¡å™¨å·²æœ‰åˆ†ç‰‡
  // è·³è¿‡å·²ä¸Šä¼ çš„åˆ†ç‰‡
}
```

---

## âš¡ å…³é”®ç‚¹

1. **ETag**: å¿…é¡»ä»å“åº”å¤´è·å–å¹¶ä¿å­˜ï¼ˆç§»é™¤å¼•å·ï¼‰
2. **åˆ†ç‰‡ç¼–å·**: ä» 1 å¼€å§‹ï¼Œä¸æ˜¯ 0
3. **æ’åº**: complete æ—¶ parts å¿…é¡»æŒ‰ part_number æ’åº
4. **localStorage**: æ¯ä¸Šä¼ ä¸€ç‰‡åä¿å­˜è¿›åº¦

---

## ğŸ“Š å‚æ•°

- åˆ†ç‰‡å¤§å°: 5MB (5242880 å­—èŠ‚)
- æœ€å¤§æ–‡ä»¶: 500MB
- URL æœ‰æ•ˆæœŸ: 1 å°æ—¶

---

## ğŸ“ API æ–‡æ¡£

`http://localhost:8000/docs`

---

**è¯¦ç»†è§„èŒƒ**: `docs/resumable_upload/ç»™å‰ç«¯çš„æŠ€æœ¯è§„èŒƒ.md`

