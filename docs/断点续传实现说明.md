# æ–­ç‚¹ç»­ä¼ åŠŸèƒ½å®ç°è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

å‰ç«¯å·²å®Œæˆæ–­ç‚¹ç»­ä¼ åŠŸèƒ½çš„å®ç°ï¼Œæ”¯æŒå¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ ã€è¿›åº¦ä¿å­˜å’Œæ¢å¤ã€å–æ¶ˆä¸Šä¼ ç­‰åŠŸèƒ½ã€‚

## âœ… å®ç°çŠ¶æ€

- âœ… **API æ¥å£** - å…¨éƒ¨ 6 ä¸ªæ¥å£å·²å®ç°
- âœ… **æ–­ç‚¹ç»­ä¼ ç®¡ç†å™¨** - å®Œæ•´å®ç°
- âœ… **UI é›†æˆ** - å·²é›†æˆåˆ° UploadForm
- âœ… **è¿›åº¦ä¿å­˜** - localStorage è‡ªåŠ¨ä¿å­˜
- âœ… **è¿›åº¦æ¢å¤** - è‡ªåŠ¨æ£€æµ‹å¹¶æ¢å¤
- âœ… **å–æ¶ˆä¸Šä¼ ** - æ”¯æŒä¸­é€”å–æ¶ˆ

## ğŸ“¦ æ–°å¢æ–‡ä»¶

### 1. `lib/api.ts` - æ–°å¢ API æ¥å£

æ·»åŠ äº†ä»¥ä¸‹æ¥å£å’ŒåŠŸèƒ½ï¼š

```typescript
// åˆ†ç‰‡å¤§å°å¸¸é‡
export const CHUNK_SIZE = 5 * 1024 * 1024; // 5MB

// 6ä¸ªæ ¸å¿ƒæ¥å£
initMultipartUpload()      // åˆå§‹åŒ–åˆ†ç‰‡ä¸Šä¼ 
uploadPart()               // ä¸Šä¼ å•ä¸ªåˆ†ç‰‡
completeMultipartUpload()  // å®Œæˆåˆ†ç‰‡ä¸Šä¼ 
listUploadedParts()        // æŸ¥è¯¢å·²ä¸Šä¼ åˆ†ç‰‡ï¼ˆæ–­ç‚¹ç»­ä¼ ï¼‰
abortMultipartUpload()     // å–æ¶ˆä¸Šä¼ 

// è¿›åº¦ç®¡ç†
saveUploadProgress()       // ä¿å­˜è¿›åº¦åˆ° localStorage
loadUploadProgress()       // åŠ è½½è¿›åº¦
clearUploadProgress()      // æ¸…é™¤è¿›åº¦
```

### 2. `lib/resumableUpload.ts` - æ–­ç‚¹ç»­ä¼ ç®¡ç†å™¨ï¼ˆæ–°æ–‡ä»¶ï¼‰

æ ¸å¿ƒç±» `ResumableUploadManager`ï¼š

**åŠŸèƒ½ç‰¹æ€§**ï¼š
- âœ… è‡ªåŠ¨åˆ†ç‰‡ï¼šå°†å¤§æ–‡ä»¶åˆ‡åˆ†ä¸º 5MB çš„åˆ†ç‰‡
- âœ… å¹¶å‘æ§åˆ¶ï¼šé¡ºåºä¸Šä¼ åˆ†ç‰‡ï¼Œé¿å…ç½‘ç»œæ‹¥å µ
- âœ… è¿›åº¦ä¿å­˜ï¼šæ¯ä¸Šä¼ ä¸€ç‰‡åè‡ªåŠ¨ä¿å­˜åˆ° localStorage
- âœ… æ–­ç‚¹ç»­ä¼ ï¼šè‡ªåŠ¨æ£€æµ‹å·²ä¸Šä¼ åˆ†ç‰‡ï¼Œè·³è¿‡é‡å¤ä¸Šä¼ 
- âœ… å®æ—¶è¿›åº¦ï¼šæä¾›è¯¦ç»†çš„ä¸Šä¼ è¿›åº¦å›è°ƒ
- âœ… é”™è¯¯å¤„ç†ï¼šå¤±è´¥åå¯é‡æ–°å°è¯•ï¼Œå·²ä¸Šä¼ çš„ç‰‡ä¸ä¼šä¸¢å¤±
- âœ… å–æ¶ˆæ”¯æŒï¼šéšæ—¶å–æ¶ˆä¸Šä¼ 

**ä½¿ç”¨æ–¹æ³•**ï¼š

```typescript
import { uploadFileWithResumable } from "../lib/resumableUpload";

const result = await uploadFileWithResumable(
  file,
  filename,
  "master",
  {
    onProgress: (info) => {
      console.log(`è¿›åº¦: ${info.progress}%`);
      console.log(`åˆ†ç‰‡: ${info.uploadedChunks}/${info.totalChunks}`);
      console.log(`é€Ÿåº¦: ${formatSpeed(info.speed)}`);
    },
    onChunkComplete: (index, total) => {
      console.log(`åˆ†ç‰‡ ${index}/${total} å®Œæˆ`);
    },
  }
);

console.log(`ä¸Šä¼ å®Œæˆ: ${result.objectKey}`);
```

### 3. `components/UploadForm.tsx` - UI é›†æˆ

**æ–°å¢çŠ¶æ€**ï¼š
```typescript
const [isResumableUpload, setIsResumableUpload] = useState(false);
const [totalChunks, setTotalChunks] = useState(0);
const [uploadedChunks, setUploadedChunks] = useState(0);
const [currentChunk, setCurrentChunk] = useState(0);
```

**æ–°å¢å‡½æ•°**ï¼š
```typescript
handleResumableUpload() // æ–­ç‚¹ç»­ä¼ ä¸Šä¼ æµç¨‹
```

**ä¸Šä¼ æ¨¡å¼é€‰æ‹©é€»è¾‘**ï¼š
- **< 10MB**ï¼šç›´æ¥ä¸Šä¼ ï¼ˆæ—§æµç¨‹ï¼‰
- **10MB - 50MB**ï¼šæ–­ç‚¹ç»­ä¼ ï¼ˆæ–°æµç¨‹ï¼‰
- **> 50MB**ï¼šæ–­ç‚¹ç»­ä¼ ï¼ˆæ–°æµç¨‹ï¼Œæ›´å¯é ï¼‰

## ğŸ”„ å®Œæ•´ä¸Šä¼ æµç¨‹

### 1. åˆå§‹åŒ–é˜¶æ®µ

```
ç”¨æˆ·é€‰æ‹©æ–‡ä»¶ â†’ ç‚¹å‡»æäº¤
  â†“
åˆ¤æ–­æ–‡ä»¶å¤§å°
  â†“
åˆ›å»º AbortController
  â†“
è°ƒç”¨ initMultipartUpload
  â†“
è·å– task_id, upload_id, parts[]
```

### 2. ä¸Šä¼ é˜¶æ®µ

```
å¯¹äºæ¯ä¸ªåˆ†ç‰‡:
  â†“
æ£€æŸ¥æ˜¯å¦å·²ä¸Šä¼ ï¼ˆlocalStorage / æœåŠ¡å™¨æŸ¥è¯¢ï¼‰
  â†“
å¦‚æœæœªä¸Šä¼ :
  - file.slice(start, end) â†’ åˆ‡åˆ†æ–‡ä»¶
  - uploadPart() â†’ PUT åˆ° TOS
  - è·å– ETag
  - ä¿å­˜åˆ° uploadedParts
  - saveUploadProgress() â†’ localStorage
  â†“
æ›´æ–° UI è¿›åº¦
```

### 3. å®Œæˆé˜¶æ®µ

```
æ‰€æœ‰åˆ†ç‰‡ä¸Šä¼ å®Œæˆ
  â†“
æŒ‰ part_number æ’åº parts
  â†“
è°ƒç”¨ completeMultipartUpload
  â†“
è°ƒç”¨ confirmUploadï¼ˆæäº¤ä»»åŠ¡ï¼‰
  â†“
æ¸…é™¤ localStorage è¿›åº¦
  â†“
è§¦å‘ "speos-task-created" äº‹ä»¶
  â†“
é‡ç½®è¡¨å•
```

## ğŸ“Š è¿›åº¦ä¿å­˜æ ¼å¼

**localStorage Key**:
```
resumable_upload_{task_id}_{file_type}
```

**ä¿å­˜çš„æ•°æ®**:
```json
{
  "task_id": "abc-123",
  "upload_id": "upload-xyz",
  "object_key": "speos_tasks/...",
  "file_type": "master",
  "filename": "model.zip",
  "file_size": 524288000,
  "total_chunks": 100,
  "uploaded_parts": [
    {"part_number": 1, "etag": "abc123"},
    {"part_number": 2, "etag": "def456"}
  ],
  "timestamp": 1699999999999
}
```

## ğŸ¯ æ–­ç‚¹ç»­ä¼ å®ç°ç»†èŠ‚

### 1. æ£€æµ‹å·²ä¸Šä¼ åˆ†ç‰‡

```typescript
// æ­¥éª¤ 1: æ£€æŸ¥ localStorage
const savedProgress = loadUploadProgress(taskId, fileType);
if (savedProgress) {
  // æ¢å¤å·²ä¸Šä¼ çš„åˆ†ç‰‡åˆ—è¡¨
  uploadedParts = savedProgress.uploaded_parts;
}

// æ­¥éª¤ 2: æŸ¥è¯¢æœåŠ¡å™¨ï¼ˆåŒé‡ç¡®è®¤ï¼‰
const listResponse = await listUploadedParts({
  task_id, upload_id, object_key
});
uploadedParts = listResponse.parts;
```

### 2. è·³è¿‡å·²ä¸Šä¼ åˆ†ç‰‡

```typescript
const uploadedPartNumbers = new Set(
  uploadedParts.map(p => p.part_number)
);

for (const part of allParts) {
  if (uploadedPartNumbers.has(part.part_number)) {
    console.log(`â­ï¸ è·³è¿‡åˆ†ç‰‡ ${part.part_number}`);
    continue; // è·³è¿‡
  }
  
  // ä¸Šä¼ åˆ†ç‰‡
  await uploadChunk(part);
}
```

### 3. ETag å¤„ç†

```typescript
// ä¸Šä¼ åˆ†ç‰‡æ—¶è·å– ETag
const xhr = new XMLHttpRequest();
xhr.onload = () => {
  // ä»å“åº”å¤´è·å– ETag
  const etag = xhr.getResponseHeader("ETag");
  
  // ç§»é™¤å¼•å·ï¼ˆé‡è¦ï¼ï¼‰
  const cleanETag = etag.replace(/^"(.*)"$/, "$1");
  
  // ä¿å­˜
  uploadedParts.push({
    part_number: partNumber,
    etag: cleanETag
  });
};

xhr.open("PUT", uploadUrl);
xhr.send(chunk);
```

## ğŸ’¡ UI å¢å¼º

### è¿›åº¦æ˜¾ç¤º

**æ–­ç‚¹ç»­ä¼ æ¨¡å¼**ï¼š
```
ğŸ“¦ ä½¿ç”¨æ–­ç‚¹ç»­ä¼ æ¨¡å¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 65%

é€Ÿåº¦: 2.5 MB/s    å‰©ä½™æ—¶é—´: 1 åˆ† 23 ç§’

ğŸ“¦ åˆ†ç‰‡ä¸Šä¼ æ¨¡å¼    42/100 ç‰‡
å½“å‰åˆ†ç‰‡: #43
```

**æ™®é€šæ¨¡å¼**ï¼š
```
â¬†ï¸ ä¸Šä¼  Master æ–‡ä»¶...
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 45%

é€Ÿåº¦: 3.2 MB/s    å‰©ä½™æ—¶é—´: 45 ç§’

Master æ–‡ä»¶: 45%
```

### æç¤ºä¿¡æ¯ä¼˜åŒ–

```typescript
// å¤§æ–‡ä»¶æç¤º
"æ–‡ä»¶è¾ƒå¤§ï¼ˆ125 MBï¼‰ï¼Œå°†ä½¿ç”¨æ–­ç‚¹ç»­ä¼ ä¸Šä¼ ï¼Œæ”¯æŒæš‚åœæ¢å¤ã€‚æ˜¯å¦ç»§ç»­ï¼Ÿ"

// ä¸Šä¼ æ­¥éª¤æç¤º
"ğŸ“¦ ä½¿ç”¨æ–­ç‚¹ç»­ä¼ æ¨¡å¼"
"â¬†ï¸ ä¸Šä¼  Master æ–‡ä»¶ï¼ˆåˆ†ç‰‡æ¨¡å¼ï¼‰"
"â¬†ï¸ ä¸Šä¼  Include æ–‡ä»¶ï¼ˆåˆ†ç‰‡æ¨¡å¼ï¼‰"
"âœ… æäº¤ä»»åŠ¡..."
"ğŸ‰ å®Œæˆï¼"
```

## ğŸ§ª æµ‹è¯•åœºæ™¯

### åœºæ™¯ 1ï¼šæ­£å¸¸ä¸Šä¼ ï¼ˆä¸­ç­‰æ–‡ä»¶ï¼‰

**æ–‡ä»¶å¤§å°**ï¼š20MB

**é¢„æœŸæµç¨‹**ï¼š
```
1. æ£€æµ‹åˆ°æ–‡ä»¶ > 10MB â†’ ä½¿ç”¨æ–­ç‚¹ç»­ä¼ 
2. åˆ†ç‰‡ï¼š20MB Ã· 5MB = 4 ç‰‡
3. ä¾æ¬¡ä¸Šä¼  4 ä¸ªåˆ†ç‰‡
4. æ¯ç‰‡ä¸Šä¼ åä¿å­˜è¿›åº¦åˆ° localStorage
5. å®Œæˆååˆå¹¶åˆ†ç‰‡
6. æäº¤ä»»åŠ¡
7. æ¸…é™¤ localStorage
```

**UI æ˜¾ç¤º**ï¼š
- è¿›åº¦æ¡ï¼š0% â†’ 25% â†’ 50% â†’ 75% â†’ 100%
- åˆ†ç‰‡ä¿¡æ¯ï¼š0/4 â†’ 1/4 â†’ 2/4 â†’ 3/4 â†’ 4/4

### åœºæ™¯ 2ï¼šæ–­ç‚¹ç»­ä¼ ï¼ˆå¤§æ–‡ä»¶ + ä¸­æ–­ï¼‰

**æ–‡ä»¶å¤§å°**ï¼š100MBï¼ˆ20 ç‰‡ï¼‰

**æµç¨‹**ï¼š
```
1. å¼€å§‹ä¸Šä¼ 
2. ä¸Šä¼ åˆ°ç¬¬ 8 ç‰‡æ—¶ï¼Œç”¨æˆ·å…³é—­æµè§ˆå™¨
3. localStorage ä¿å­˜ï¼šå·²ä¸Šä¼  1-8 ç‰‡
4. ç”¨æˆ·é‡æ–°æ‰“å¼€é¡µé¢
5. é€‰æ‹©ç›¸åŒæ–‡ä»¶ï¼Œç‚¹å‡»æäº¤
6. ç³»ç»Ÿæ£€æµ‹åˆ° localStorage æœ‰è¿›åº¦
7. æŸ¥è¯¢æœåŠ¡å™¨å·²ä¸Šä¼ åˆ†ç‰‡ï¼š1-8 ç‰‡
8. è·³è¿‡ 1-8 ç‰‡ï¼Œä»ç¬¬ 9 ç‰‡å¼€å§‹ä¸Šä¼ 
9. ä¸Šä¼  9-20 ç‰‡
10. å®Œæˆ
```

**æ§åˆ¶å°æ—¥å¿—**ï¼š
```
ğŸ“¥ åŠ è½½ä¸Šä¼ è¿›åº¦: model.zip, å·²ä¸Šä¼  8/20 ç‰‡
ğŸ“Š æœåŠ¡å™¨è®°å½•æ˜¾ç¤ºå·²ä¸Šä¼  8 ç‰‡ï¼Œè·³è¿‡è¿™äº›åˆ†ç‰‡
â­ï¸ è·³è¿‡åˆ†ç‰‡ 1/20
â­ï¸ è·³è¿‡åˆ†ç‰‡ 2/20
...
â­ï¸ è·³è¿‡åˆ†ç‰‡ 8/20
â¬†ï¸ ä¸Šä¼ åˆ†ç‰‡ 9/20 (5 MB)
âœ… åˆ†ç‰‡ 9 ä¸Šä¼ æˆåŠŸ, ETag=xxx
...
```

### åœºæ™¯ 3ï¼šç½‘ç»œä¸­æ–­æ¢å¤

**æ–‡ä»¶å¤§å°**ï¼š50MBï¼ˆ10 ç‰‡ï¼‰

**æµç¨‹**ï¼š
```
1. å¼€å§‹ä¸Šä¼ 
2. ä¸Šä¼ åˆ°ç¬¬ 5 ç‰‡æ—¶ï¼Œç½‘ç»œæ–­å¼€
3. ä¸Šä¼ å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯æç¤º
4. localStorage ä»ä¿ç•™ 1-4 ç‰‡çš„è¿›åº¦
5. ç½‘ç»œæ¢å¤åï¼Œç”¨æˆ·å†æ¬¡ç‚¹å‡»æäº¤
6. ä»ç¬¬ 5 ç‰‡å¼€å§‹ç»§ç»­ä¸Šä¼ 
7. å®Œæˆ
```

### åœºæ™¯ 4ï¼šå–æ¶ˆä¸Šä¼ 

**æ–‡ä»¶å¤§å°**ï¼š200MBï¼ˆ40 ç‰‡ï¼‰

**æµç¨‹**ï¼š
```
1. å¼€å§‹ä¸Šä¼ 
2. ä¸Šä¼ åˆ°ç¬¬ 10 ç‰‡
3. ç”¨æˆ·ç‚¹å‡»"å–æ¶ˆä¸Šä¼ "
4. è°ƒç”¨ abortMultipartUpload
5. æ¸…é™¤ localStorage
6. é‡ç½® UI çŠ¶æ€
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. ETag å¤„ç†

**âŒ é”™è¯¯**ï¼š
```typescript
const etag = xhr.getResponseHeader("ETag");
// etag = '"abc123"'  ï¼ˆå¸¦å¼•å·ï¼‰
uploadedParts.push({ part_number: 1, etag }); // é”™è¯¯ï¼
```

**âœ… æ­£ç¡®**ï¼š
```typescript
const etag = xhr.getResponseHeader("ETag");
const cleanETag = etag.replace(/^"(.*)"$/, "$1");
// cleanETag = 'abc123'  ï¼ˆæ— å¼•å·ï¼‰
uploadedParts.push({ part_number: 1, etag: cleanETag }); // æ­£ç¡®ï¼
```

### 2. åˆ†ç‰‡æ’åº

**âŒ é”™è¯¯**ï¼š
```typescript
// ä¸æ’åºç›´æ¥æäº¤
await completeMultipartUpload({
  parts: uploadedParts  // å¯èƒ½ä¹±åºï¼
});
```

**âœ… æ­£ç¡®**ï¼š
```typescript
// æŒ‰ part_number æ’åº
const sortedParts = [...uploadedParts].sort(
  (a, b) => a.part_number - b.part_number
);

await completeMultipartUpload({
  parts: sortedParts  // ç¡®ä¿æœ‰åº
});
```

### 3. åˆ†ç‰‡ç¼–å·

**âŒ é”™è¯¯**ï¼š
```typescript
// ä» 0 å¼€å§‹
for (let i = 0; i < parts.length; i++) {
  const partNumber = i; // é”™è¯¯ï¼šåº”è¯¥ä» 1 å¼€å§‹
}
```

**âœ… æ­£ç¡®**ï¼š
```typescript
// ä» 1 å¼€å§‹
for (let i = 0; i < parts.length; i++) {
  const partNumber = i + 1; // æ­£ç¡®
}
```

### 4. localStorage é™åˆ¶

- **å¤§å°é™åˆ¶**ï¼šçº¦ 5-10MB
- **å­˜å‚¨ç­–ç•¥**ï¼šåªä¿å­˜å¿…è¦ä¿¡æ¯ï¼ˆpartsåˆ—è¡¨ï¼Œä¸ä¿å­˜æ–‡ä»¶å†…å®¹ï¼‰
- **æ¸…ç†ç­–ç•¥**ï¼šä¸Šä¼ æˆåŠŸåç«‹å³æ¸…é™¤
- **éšç§ä¿æŠ¤**ï¼šä¸ä¿å­˜æ•æ„Ÿä¿¡æ¯

## ğŸ”§ é…ç½®å‚æ•°

### lib/api.ts

```typescript
// åˆ†ç‰‡å¤§å°ï¼š5MB
export const CHUNK_SIZE = 5 * 1024 * 1024;
```

### components/UploadForm.tsx

```typescript
// ä¸Šä¼ æ¨¡å¼é˜ˆå€¼
const SIMPLE_UPLOAD_THRESHOLD = 50 * 1024 * 1024;  // 50MB
const RESUMABLE_UPLOAD_THRESHOLD = 10 * 1024 * 1024; // 10MB
```

**ä¿®æ”¹å»ºè®®**ï¼š
- é™ä½ `RESUMABLE_UPLOAD_THRESHOLD` åˆ° `5 * 1024 * 1024` (5MB) - æ›´æ—©ä½¿ç”¨æ–­ç‚¹ç»­ä¼ 
- æé«˜ `CHUNK_SIZE` åˆ° `10 * 1024 * 1024` (10MB) - å‡å°‘åˆ†ç‰‡æ•°é‡ï¼ˆç½‘ç»œå¥½æ—¶ï¼‰

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. å¹¶å‘ä¸Šä¼ ï¼ˆå¯é€‰ï¼‰

å½“å‰å®ç°æ˜¯**é¡ºåºä¸Šä¼ **ï¼ˆä¸€ç‰‡ä¸Šä¼ å®Œå†ä¸Šä¼ ä¸‹ä¸€ç‰‡ï¼‰ï¼Œæ›´å®‰å…¨ä½†è¾ƒæ…¢ã€‚

å¯ä»¥ä¿®æ”¹ä¸º**å¹¶å‘ä¸Šä¼ **ï¼ˆåŒæ—¶ä¸Šä¼ å¤šç‰‡ï¼‰ï¼Œæ›´å¿«ä½†éœ€è¦æ›´å¤šèµ„æºï¼š

```typescript
// å¹¶å‘ä¸Šä¼  3 ä¸ªåˆ†ç‰‡
const CONCURRENT_UPLOADS = 3;

const queue = [...allParts];
const uploading = new Set();

while (queue.length > 0 || uploading.size > 0) {
  while (uploading.size < CONCURRENT_UPLOADS && queue.length > 0) {
    const part = queue.shift();
    const promise = uploadChunk(part).finally(() => uploading.delete(promise));
    uploading.add(promise);
  }
  
  await Promise.race([...uploading]);
}
```

### 2. æ–­ç‚¹ç»­ä¼ ä¼˜åŒ–

```typescript
// å®šæœŸæ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€ï¼ˆé¿å…æœ¬åœ°å’ŒæœåŠ¡å™¨ä¸ä¸€è‡´ï¼‰
const CHECK_INTERVAL = 10; // æ¯ä¸Šä¼  10 ç‰‡æ£€æŸ¥ä¸€æ¬¡

if (uploadedChunks % CHECK_INTERVAL === 0) {
  const serverParts = await listUploadedParts(...);
  // å¯¹æ¯”å¹¶æ›´æ–°æœ¬åœ°è®°å½•
}
```

## ğŸ› å¸¸è§é—®é¢˜

### Q1: æ–­ç‚¹ç»­ä¼ ä¸ç”Ÿæ•ˆï¼Ÿ

**æ£€æŸ¥æ¸…å•**ï¼š
1. âœ… localStorage æ˜¯å¦æœ‰æƒé™ï¼Ÿ
2. âœ… task_id æ˜¯å¦ä¸€è‡´ï¼Ÿ
3. âœ… æœåŠ¡å™¨æ˜¯å¦æ”¯æŒ listUploadedPartsï¼Ÿ
4. âœ… æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯æ—¥å¿—ï¼Ÿ

**è°ƒè¯•**ï¼š
```javascript
// æ‰“å¼€æ§åˆ¶å°
localStorage.getItem(`resumable_upload_${taskId}_master`);
// åº”è¯¥çœ‹åˆ°ä¿å­˜çš„è¿›åº¦JSON
```

### Q2: ETag é”™è¯¯ï¼Ÿ

**ç—‡çŠ¶**ï¼šå®Œæˆä¸Šä¼ æ—¶æŠ¥é”™ "Invalid ETag"

**åŸå› **ï¼šETag ä¸­åŒ…å«å¼•å·

**è§£å†³**ï¼š
```typescript
const cleanETag = etag.replace(/^"(.*)"$/, "$1");
```

### Q3: åˆ†ç‰‡é¡ºåºé”™è¯¯ï¼Ÿ

**ç—‡çŠ¶**ï¼šå®Œæˆä¸Šä¼ æ—¶æŠ¥é”™ "Parts not in order"

**è§£å†³**ï¼š
```typescript
const sortedParts = [...uploadedParts].sort((a, b) => a.part_number - b.part_number);
```

### Q4: localStorage æ»¡äº†ï¼Ÿ

**ç—‡çŠ¶**ï¼šæ— æ³•ä¿å­˜è¿›åº¦

**è§£å†³**ï¼š
```typescript
// æ¸…ç†æ—§çš„ä¸Šä¼ è®°å½•
const keys = Object.keys(localStorage);
keys.filter(k => k.startsWith('resumable_upload_'))
    .forEach(k => {
      const data = JSON.parse(localStorage.getItem(k));
      // æ¸…ç† 7 å¤©å‰çš„è®°å½•
      if (Date.now() - data.timestamp > 7 * 24 * 60 * 60 * 1000) {
        localStorage.removeItem(k);
      }
    });
```

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [åç«¯æ¥å£è§„èŒƒ](./ã€ç»™å‰ç«¯ã€‘æ–­ç‚¹ç»­ä¼ æ¥å£è§„èŒƒ.md)
- [API æ–‡æ¡£](http://localhost:8000/docs)
- [MDN: XMLHttpRequest](https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest)
- [MDN: localStorage](https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage)

## âœ… å®Œæˆæ¸…å•

- [x] API æ¥å£å®ç°ï¼ˆ6 ä¸ªï¼‰
- [x] æ–­ç‚¹ç»­ä¼ ç®¡ç†å™¨
- [x] UI é›†æˆ
- [x] è¿›åº¦ä¿å­˜å’Œæ¢å¤
- [x] åˆ†ç‰‡è¿›åº¦æ˜¾ç¤º
- [x] å–æ¶ˆä¸Šä¼ æ”¯æŒ
- [x] é”™è¯¯å¤„ç†
- [x] ETag å¤„ç†
- [x] åˆ†ç‰‡æ’åº
- [x] æ–‡æ¡£ç¼–å†™

---

**å®ç°æ—¥æœŸ**ï¼š2025-11-05  
**å®ç°æ–‡ä»¶**ï¼š
- `lib/api.ts`ï¼ˆæ›´æ–°ï¼‰
- `lib/resumableUpload.ts`ï¼ˆæ–°å¢ï¼‰
- `components/UploadForm.tsx`ï¼ˆæ›´æ–°ï¼‰

